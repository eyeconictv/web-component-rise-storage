<link rel="import" href="/components/polymer/polymer.html">
<link rel="import" href="/components/core-ajax/core-ajax.html">

<!--
The `rise-storage` element retrieves URLs of files stored in Rise Storage.

    <rise-storage
      companyId="my-company-id"
      folder="my-folder"
      fileName="my-image.png"
      folderRefresh="60"></rise-storage>

You can trigger a request explicitly by calling `go` on the
element.

@element rise-storage
@status alpha
@homepage https://github.com/Rise-Vision/web-component-rise-storage
-->
<polymer-element name="rise-storage" attributes="companyId folder fileName folderRefresh">
  <template>
    <core-ajax id="ajax"
      url="{{url}}"
      handleAs="json"
      on-core-response="{{handleResponse}}"
      on-core-error="{{handleError}}"
      auto>
    </core-ajax>
  </template>

  <script>
    Polymer("rise-storage", {
      /**
       * Fired when a response is received.
       *
       * @event rise-storage-response
       */

      /**
       * Fired when an error is received.
       *
       * @event rise-storage-error
       */

      /**
       * The ID of the Company.
       *
       * @attribute companyId
       * @type string
       * @default ""
       */
      companyId: "",

      /**
       * The folder name.
       *
       * @attribute folder
       * @type string
       * @default ""
       */
      folder: "",

      /**
       * The file name within the folder.
       *
       * @attribute fileName
       * @type string
       * @default ""
       */
      fileName: "",

      /**
       * The number of seconds before the folder will be checked for changes.

       *
       * @attribute folderRefresh
       * @type number
       * @default 0
       */
      folderRefresh: 0,

      /**
       * The URL target of the request.
       *
       * @property url
       * @type string
       * @default ''
       */
      url: "",

      ready: function() {
        // TODO: Set url on core-ajax element.
      },

      companyIdChanged: function() {
        this.go();
      },

      folderChanged: function() {
        this.go();
      },

      fileNameChanged: function() {
        this.go();
      },

      handleResponse: function(e, detail, sender) {
        // TODO: Send back array of URLs.
        this.fire("rise-storage-response", []);
      },

      handleError: function(e, detail, sender){
        console.log("Error:", e.detail);

        this.fire("rise-storage-error", e)
      },

      /**
       * Performs an Ajax request to the specified URL.
       *
       * @method go
       */
      go: function() {
        this.$.ajax.go();
      }
    });
  </script>
</polymer-element>
